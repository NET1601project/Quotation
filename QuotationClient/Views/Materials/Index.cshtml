@model IEnumerable<Domain.Material>

@{
    ViewData["Title"] = "Index";
}
@* <style>
    body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 13px;
        color: #555;
        background: #ececec;
        margin-top: 20px;
    }

    .project-list > tbody > tr > td {
        /* padding: 12px 8px; */
    }

        .project-list > tbody > tr > td .avatar {
            width: auto;
            height: 50px;
            border: 1px solid #CCC;
        }
</style> *@
<div class="alldiv" id="checkRole" style="display: none;">

    <div id="error-message">
        <h1>Index</h1>

        <p>
            <a asp-action="Create">Create New</a>
        </p>
        <a href="/Home/HomePage">BACK</a>

        <table class="table">
            <thead>
                <tr>
                    <th>
                        Material ID
                    </th>
                    <th>
                        MaterialName
                    </th>
                    <th>
                        Description
                    </th>
                    <th>
                        UnitPrice
                    </th>
                    <th>
                        Stock
                    </th>
                    <th>
                        CreateDate
                    </th>
                    <th>
                        Image
                    </th>

                    <th></th>
                </tr>
            </thead>
            <tbody id="listMaterial">

                <tr id="error-message"></tr>

            </tbody>
        </table>
    </div>
</div>
@section scripts {
    <script>
        var token = localStorage.getItem('jwtToken');
        var role = localStorage.getItem('role');
        if (role === "STAFF") {
            document.getElementById('checkRole').style.display = "block";
        }
        $(document).ready(function () {
            $.ajax({
                url: 'https://localhost:7222/api/Materials/GetMaterials',
                type: 'GET',
                dataType: 'json',
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                success: function (data) {
                    displayProjects(data);
                    console.log(data);
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.log('Error:', xhr.responseText)
                    var tableHtml = 'An error occurred.';
                    $('#error-message').text(xhr.responseText);
                }

            });
        });
        function displayProjects(data) {

            var tableHtml = '';
            data.forEach(function (material) {
                tableHtml += '<tr>';
                tableHtml += '<td>' + material.materialID + '</td>';
                tableHtml += '<td>' + material.materialName + '</td>';
                tableHtml += '<td>' + material.description + '</td>';
                tableHtml += '<td>' + material.unitPrice + '</td>';
                tableHtml += '<td>' +  material.stock + '</td>';
                tableHtml += '<td>' + material.createDate + '</td>';
                tableHtml += '<td>' + '<img src="' + material.image + '" alt="Avatar" class="avatar img-circle" style="width: 100px; height: 62.27px;">' + '</td>';
                tableHtml += '<td><button class="btn btn-primary detail-btn" data-material-id="' + material.materialID + '">Detail</button></td>';

                tableHtml += '</tr>';
            });
            $('#listMaterial').html(tableHtml);
            $('.detail-btn').click(function () {
                var materialId = $(this).data('material-id');

                $.ajax({
                    type: "GET",
                    url: "https://localhost:7222/api/Materials/GetMaterialById?id=" + materialId,
                    success: function (response) {
                        console.log(response);
                        window.location.href = '/Materials/Details?materialId=' + materialId;

                    },
                    error: function (xhr, status, error) {
                        console.error(xhr.responseText);
                    }
                });
            });
        }

    </script>
}