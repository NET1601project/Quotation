@{
    ViewData["Title"] = "Details";
}
<div class="all" id="checkRoleStaff" style="display: none;">

    <h1>Details</h1>

    <div>
        <h4>QuoteDetail</h4>
        <hr />
        <dl class="row">
            <dt class="col-sm-2">
                Quote ID
            </dt>
            <dd class="col-sm-10" id="QuoteID">

            </dd>
            <dt class="col-sm-2">
                QuoteDate
            </dt>
            <dd class="col-sm-10" id="QuoteDate">
            </dd>
            <dt class="col-sm-2">
                Status
            </dt>
            <dd class="col-sm-10" id="Status">
            </dd>
            <dt class="col-sm-2">
                TotalAmount
            </dt>
            <dd class="col-sm-10" id="TotalAmount">
            </dd>
            <dt class="col-sm-2">
                Project
            </dt>
            <dd class="col-sm-10" id="Project">
            </dd>
            <dt class="col-sm-2">
                Staff
            </dt>
            <dd class="col-sm-10" id="Staff">

            </dd>
        </dl>
        <div id="qouteDetails"></div>
    </div>
    <div>
        <a href="#" id="editLink" style="display:none;">Edit</a>
        <a asp-action="Index">Back to List</a>
    </div>
</div>
@section scripts {
    <script>
        var token = localStorage.getItem('jwtToken');
        var role = localStorage.getItem('role');
        if (role.length != null) {
            document.getElementById('checkRoleStaff').style.display = 'block';


            $(document).ready(function () {
                const urlParams = new URLSearchParams(window.location.search);
                const quoteDetailId = urlParams.get('QuoteDetailId');

                console.log(quoteDetailId);
                $.ajax({
                    method: "GET",
                    url: "https://localhost:7222/api/Quotes/GetQuote?id=" + quoteDetailId,
                    success: function (qou) {
                        $('#QuoteID').text(qou.quoteID);
                        $('#QuoteNumber').text(qou.quoteNumber);
                        $('#QuoteDate').text(qou.quoteDate);
                        $('#Status').text(qou.status);
                        $('#TotalAmount').text(qou.totalAmount);
                        $('#Project').text(qou.projectID);
                        $('#Material').text(qou.materialID);
                        $('#Staff').text(qou.staffId);
                        if (role === 'STAFF') {
                            document.getElementById('editLink').style.display = 'block';
                            $('#editLink').attr('href', '/Quotes/Edit?quouteId=' + qou.quoteID);
                        }
                        console.log(qou);
                        if (qou.responseQuoteDetails.length > 0) {
                            var detailsHtml = '<h4>Qoute Details</h4><table class="table"><thead><tr><th>Material ID</th><th>Material Name</th><th>Number</th><th>Price</th></tr></thead><tbody>';

                            qou.responseQuoteDetails.forEach(function (detail) {
                                detailsHtml += '<tr>';
                                detailsHtml += '<td>' + "<img src=" + detail.image + " style='height: 80px; width: 150px;' alt='Alternate Text' />" + '</td>';
                                detailsHtml += '<td>' + detail.materialName + '</td>';
                                detailsHtml += '<td>' + detail.numberMaterial + '</td>';
                                detailsHtml += '<td>' + detail.price + '</td>';
                                detailsHtml += '</tr>';
                            });

                            detailsHtml += '</tbody></table>';
                            $('#qouteDetails').html(detailsHtml);
                        }
                    },
                    error: function (xhr, status, error) {
                        var errorObj = JSON.parse(xhr.responseText);
                        var errors = errorObj.errors;
                        var errorMessages = "";
                        for (var key in errors) {
                            if (errors.hasOwnProperty(key)) {
                                errorMessages += key + ": " + errors[key] + "\n";
                            }
                        }
                        alert(errorMessages);
                    }
                })
            })
        }

    </script>
}